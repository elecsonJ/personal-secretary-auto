<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ ë¹„ì„œ ìë™í™” ì‹œìŠ¤í…œ</title>
    
    <!-- PWA ì„¤ì • -->
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ê°œì¸ë¹„ì„œ">
    
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 300;
            flex-grow: 1;
            text-align: center;
        }
        
        .refresh-icon {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .refresh-icon:hover {
            background: rgba(255, 255, 255, 0.35);
            border: 2px solid rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .refresh-icon:active {
            transform: scale(0.95) rotate(180deg);
            background: rgba(255, 255, 255, 0.4);
        }
        
        @keyframes refreshSpin {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.05) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        
        .refresh-icon.spinning {
            animation: refreshSpin 0.6s ease-in-out;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .status-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-value {
            opacity: 0.8;
            font-size: 14px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .log-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin-top: 20px;
        }
        
        .setup-section {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 20px;
            margin-top: 20px;
        }
        
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .success {
            color: #4CAF50;
        }
        
        .error {
            color: #f44336;
        }
        
        .warning {
            color: #FF9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div></div> <!-- ë¹ˆ ê³µê°„ìœ¼ë¡œ ì¤‘ì•™ ì •ë ¬ ìœ ì§€ -->
            <h1>ğŸ¤– ê°œì¸ ë¹„ì„œ</h1>
            <button class="refresh-icon" onclick="refreshData()" title="ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
        </div>
        
        <!-- ìµœì‹  ì•Œë¦¼ í‘œì‹œ -->
        <div class="status-card" id="latestNotification">
            <div class="status-title">
                <span>ğŸ“±</span>
                <span>ìµœì‹  ì•Œë¦¼</span>
            </div>
            <div class="status-value" id="latestNotificationContent">ì•Œë¦¼ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
        
        <!-- ë¹ ë¥¸ ì•¡ì„¸ìŠ¤ ë²„íŠ¼ -->
        <button onclick="window.location.href='dashboard.html'" style="margin-bottom: 20px; background: rgba(255, 255, 255, 0.3);">ğŸ“± ì „ì²´ ì•Œë¦¼ ë‚´ì—­ ë³´ê¸°</button>
        
        <!-- ê°„ë‹¨í•œ ìƒíƒœ í‘œì‹œ -->
        <div class="status-card">
            <div class="status-title">
                <span>ğŸ”„</span>
                <span>ì‹œìŠ¤í…œ ìƒíƒœ</span>
            </div>
            <div class="status-value" id="systemStatus">ì´ˆê¸°í™” ì¤‘...</div>
        </div>
        
        <!-- GitHub Actions ëª¨ë‹ˆí„°ë§ -->
        <div class="status-card">
            <div class="status-title">
                <span>ğŸš€</span>
                <span>GitHub Actions ëª¨ë‹ˆí„°ë§</span>
            </div>
            <div class="status-value">
                <div>ë©”ì‹œì§€ ìˆ˜ì‹ : <span id="githubMessageCount">0</span>ê°œ</div>
                <div>ë§ˆì§€ë§‰ ìˆ˜ì‹ : <span id="lastGithubMessage">-</span></div>
                <button onclick="clearGithubMonitoring()" style="margin-top: 5px; padding: 5px 10px; font-size: 12px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 5px; cursor: pointer;">ì¹´ìš´í„° ì´ˆê¸°í™”</button>
            </div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ (ìì£¼ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ë§Œ) -->
        <button onclick="testMorningBriefing()" id="morningBtn" disabled>ğŸŒ… ì•„ì¹¨ ë¸Œë¦¬í•‘ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testEveningPrep()" id="eveningBtn" disabled>ğŸŒ† ì €ë… ì¤€ë¹„ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testWeatherCheck()" id="weatherBtn" disabled>ğŸŒ¤ï¸ ë‚ ì”¨ ì²´í¬ í…ŒìŠ¤íŠ¸</button>
        
        <!-- ì„¤ì • ì„¹ì…˜ (í•˜ë‹¨ìœ¼ë¡œ ì´ë™) -->
        <div class="setup-section">
            <h3>ğŸ”§ ì´ˆê¸° ì„¤ì • (í•œ ë²ˆë§Œ í•„ìš”)</h3>
            <button onclick="requestNotificationPermission()">ğŸ”” ì•Œë¦¼ ê¶Œí•œ ìš”ì²­</button>
            <button onclick="generateFCMToken()" id="tokenBtn" disabled>ğŸ“± FCM í† í° ìƒì„±</button>
            <input type="text" id="fcmTokenInput" placeholder="FCM í† í°ì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”">
            <button onclick="saveFCMToken()">ğŸ’¾ í† í° ì €ì¥</button>
        </div>
        
        <!-- ë¡œê·¸ ì˜ì—­ -->
        <div class="log-area" id="logArea">ì‹œìŠ¤í…œ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...\n</div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-messaging-compat.js"></script>
    
    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDOJg47e_S3-sgZJMeYZwSsy-MqS463rc0",
            authDomain: "personal-secretary-auto.firebaseapp.com",
            projectId: "personal-secretary-auto",
            storageBucket: "personal-secretary-auto.firebasestorage.app",
            messagingSenderId: "10792151581",
            appId: "1:10792151581:web:69fc187087a3566f9db4f4",
            measurementId: "G-R4097RRZ9B"
        };
        
        // Firebase ì´ˆê¸°í™”
        let messaging = null;
        let fcmToken = localStorage.getItem('fcmToken');
        
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleString('ko-KR');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logArea.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function updateStatus() {
            const systemStatus = document.getElementById('systemStatus');
            
            if (fcmToken) {
                systemStatus.innerHTML = `<span class="success">ì¤€ë¹„ ì™„ë£Œ</span>`;
                
                // ë²„íŠ¼ë“¤ í™œì„±í™”
                document.getElementById('morningBtn').disabled = false;
                document.getElementById('eveningBtn').disabled = false;
                document.getElementById('weatherBtn').disabled = false;
            } else {
                systemStatus.innerHTML = `<span class="warning">FCM í† í° í•„ìš”</span>`;
            }
            
            // ìµœì‹  ì•Œë¦¼ ì—…ë°ì´íŠ¸
            updateLatestNotification();
        }
        
        function updateLatestNotification() {
            const latestContent = document.getElementById('latestNotificationContent');
            
            try {
                const history = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
                
                if (history.length === 0) {
                    latestContent.innerHTML = 'ì•Œë¦¼ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤';
                    return;
                }
                
                const latest = history[0];
                const timeAgo = getTimeAgo(latest.timestamp);
                const emoji = getNotificationEmoji(latest.data?.type);
                
                latestContent.innerHTML = `
                    <div style="margin-bottom: 5px;">
                        <strong>${emoji} ${latest.title}</strong>
                        <span style="font-size: 12px; opacity: 0.7; margin-left: 10px;">${timeAgo}</span>
                    </div>
                    <div style="font-size: 14px; opacity: 0.8; max-height: 60px; overflow: hidden; text-overflow: ellipsis;">
                        ${latest.body.length > 100 ? latest.body.substring(0, 100) + '...' : latest.body}
                    </div>
                `;
                
            } catch (error) {
                latestContent.innerHTML = 'ì•Œë¦¼ ë¡œë“œ ì‹¤íŒ¨';
            }
        }
        
        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diff = now - time;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            if (minutes < 1) return 'ë°©ê¸ˆ ì „';
            if (minutes < 60) return `${minutes}ë¶„ ì „`;
            if (hours < 24) return `${hours}ì‹œê°„ ì „`;
            return time.toLocaleDateString('ko-KR');
        }
        
        function getNotificationEmoji(type) {
            const typeMap = {
                'weather_daily': 'ğŸŒ¤ï¸',
                'weather_urgent': 'âš ï¸',
                'task_daily': 'ğŸ“…',
                'task_urgent': 'ğŸ¯',
                'news_main': 'ğŸ“°',
                'news_tech': 'ğŸ¤–',
                'news_science': 'ğŸ”¬',
                'news_business': 'ğŸ’°',
                'general': 'ğŸ“¢'
            };
            return typeMap[type] || 'ğŸ“¢';
        }
        
        async function requestNotificationPermission() {
            try {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        log('ì•Œë¦¼ ê¶Œí•œì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                        document.getElementById('tokenBtn').disabled = false;
                        return true;
                    } else {
                        log('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                        return false;
                    }
                } else {
                    log('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    return false;
                }
            } catch (error) {
                log('ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
                return false;
            }
        }
        
        async function generateFCMToken() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                messaging = firebase.messaging();
                
                const token = await messaging.getToken();
                if (token) {
                    fcmToken = token;
                    localStorage.setItem('fcmToken', token);
                    document.getElementById('fcmTokenInput').value = token;
                    log('FCM í† í°ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    log('í† í°: ' + token, 'info');
                    updateStatus();
                } else {
                    log('FCM í† í° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                log('FCM í† í° ìƒì„± ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        function saveFCMToken() {
            const inputToken = document.getElementById('fcmTokenInput').value.trim();
            if (inputToken) {
                fcmToken = inputToken;
                localStorage.setItem('fcmToken', inputToken);
                log('FCM í† í°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                updateStatus();
            } else {
                log('ìœ íš¨í•œ FCM í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            }
        }
        
        async function makeTestRequest(type) {
            try {
                log(`${type} í…ŒìŠ¤íŠ¸ ìš”ì²­ ì¤‘...`, 'info');
                
                // GitHub Actions ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ API í˜¸ì¶œ)
                log(`${type} ì•Œë¦¼ì´ ì„œë²„ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`, 'success');
                log('GitHub Actionsì—ì„œ ì‹¤ì œ ì•Œë¦¼ì„ ì „ì†¡í•©ë‹ˆë‹¤.', 'info');
                
            } catch (error) {
                log(`${type} í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ` + error.message, 'error');
            }
        }
        
        function testMorningBriefing() {
            makeTestRequest('ì•„ì¹¨ ë¸Œë¦¬í•‘');
        }
        
        function testEveningPrep() {
            makeTestRequest('ì €ë… ì¤€ë¹„');
        }
        
        function testWeatherCheck() {
            makeTestRequest('ë‚ ì”¨ ì²´í¬');
        }
        
        function refreshData() {
            const refreshBtn = document.querySelector('.refresh-icon');
            
            // ìŠ¤í”¼ë‹ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            refreshBtn.classList.add('spinning');
            
            log('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘...', 'info');
            updateStatus();
            updateLatestNotification();
            
            // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ í´ë˜ìŠ¤ ì œê±°
            setTimeout(() => {
                refreshBtn.classList.remove('spinning');
                log('ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ', 'success');
            }, 600);
        }
        
        // GitHub Actions ëª¨ë‹ˆí„°ë§ í•¨ìˆ˜ë“¤
        function updateGithubMonitoring(notification) {
            const count = parseInt(localStorage.getItem('githubMessageCount') || '0') + 1;
            localStorage.setItem('githubMessageCount', count.toString());
            localStorage.setItem('lastGithubMessage', notification.timestamp);
            
            document.getElementById('githubMessageCount').textContent = count;
            document.getElementById('lastGithubMessage').textContent = formatTimeAgo(notification.timestamp);
            
            log(`ğŸš€ GitHub Actions ì•Œë¦¼ #${count}: ${notification.title}`, 'success');
        }
        
        function clearGithubMonitoring() {
            localStorage.setItem('githubMessageCount', '0');
            localStorage.removeItem('lastGithubMessage');
            
            document.getElementById('githubMessageCount').textContent = '0';
            document.getElementById('lastGithubMessage').textContent = '-';
            
            log('GitHub Actions ì¹´ìš´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
        }
        
        function formatTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
            if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
            
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
            
            return time.toLocaleString('ko-KR');
        }
        
        function loadGithubMonitoring() {
            const count = localStorage.getItem('githubMessageCount') || '0';
            const lastMessage = localStorage.getItem('lastGithubMessage');
            
            document.getElementById('githubMessageCount').textContent = count;
            document.getElementById('lastGithubMessage').textContent = 
                lastMessage ? formatTimeAgo(lastMessage) : '-';
        }
        
        // Service Worker ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ (FCM ì•Œë¦¼ ì €ì¥ìš©)
        function setupServiceWorkerMessageListener() {
            console.log('[MAIN] Service Worker ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •');
            
            navigator.serviceWorker.addEventListener('message', (event) => {
                console.log('[MAIN] Service Workerë¡œë¶€í„° ë©”ì‹œì§€ ìˆ˜ì‹ :', event.data);
                
                if (event.data && event.data.type === 'NOTIFICATION_RECEIVED') {
                    const notification = event.data.notification;
                    console.log('[MAIN] FCM ì•Œë¦¼ ë°ì´í„° ì²˜ë¦¬:', notification);
                    
                    // GitHub Actions ë©”ì‹œì§€ì¸ì§€ í™•ì¸
                    if (notification.source === 'github-actions') {
                        console.log('ğŸš€ [MAIN] GitHub Actions ì•Œë¦¼ ìˆ˜ì‹ ë¨!');
                        console.log('ğŸš€ [MAIN] ExecutionId:', notification.executionId);
                        log(`GitHub Actions ì•Œë¦¼ ìˆ˜ì‹ : ${notification.title}`, 'success');
                        
                        // GitHub Actions ì¹´ìš´í„° ì—…ë°ì´íŠ¸
                        updateGithubMonitoring(notification);
                    }
                    
                    // ê¸°ì¡´ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
                    const history = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
                    console.log('[MAIN] ê¸°ì¡´ íˆìŠ¤í† ë¦¬ í•­ëª© ìˆ˜:', history.length);
                    
                    // ì¤‘ë³µ ë°©ì§€: ê°™ì€ timestampì˜ ì•Œë¦¼ì´ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
                    const isDuplicate = history.some(item => 
                        Math.abs(new Date(item.timestamp) - new Date(notification.timestamp)) < 1000
                    );
                    
                    if (!isDuplicate) {
                        // ìƒˆ ì•Œë¦¼ì„ ë§¨ ì•ì— ì¶”ê°€
                        history.unshift(notification);
                        console.log('[MAIN] ìƒˆ ì•Œë¦¼ ì¶”ê°€ë¨. ì´ í•­ëª© ìˆ˜:', history.length);
                        
                        // ìµœëŒ€ 100ê°œê¹Œì§€ë§Œ ë³´ê´€
                        if (history.length > 100) {
                            history.splice(100);
                            console.log('[MAIN] íˆìŠ¤í† ë¦¬ 100ê°œë¡œ ì œí•œ');
                        }
                        
                        // localStorageì— ì €ì¥
                        localStorage.setItem('notificationHistory', JSON.stringify(history));
                        console.log('[MAIN] ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ì €ì¥ ì™„ë£Œ');
                        
                        // UI ì—…ë°ì´íŠ¸
                        updateLatestNotification();
                        log(`FCM ì•Œë¦¼ ì €ì¥: ${notification.title}`, 'success');
                    } else {
                        console.log('[MAIN] ì¤‘ë³µ ì•Œë¦¼ ë¬´ì‹œë¨');
                    }
                }
            });
        }
        
        // í…ŒìŠ¤íŠ¸ìš© ì•Œë¦¼ ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜
        function addTestNotificationData() {
            const existingHistory = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
            
            // ì´ë¯¸ í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
            if (existingHistory.length > 0) return;
            
            const testNotifications = [
                {
                    id: Date.now(),
                    title: 'ğŸŒ¤ï¸ ì˜¤ëŠ˜ ë‚ ì”¨',
                    body: '22Â°C â˜€ï¸ ë§‘ìŒ\nê°•ìˆ˜í™•ë¥ : 10%\në¯¸ì„¸ë¨¼ì§€: ì¢‹ìŒ',
                    data: { type: 'weather_daily' },
                    timestamp: new Date(Date.now() - 3600000).toISOString(), // 1ì‹œê°„ ì „
                    sent: true
                },
                {
                    id: Date.now() + 1,
                    title: 'ğŸ“° ë©”ì¸ ë‰´ìŠ¤',
                    body: '1. ì£¼ìš” ê²½ì œ ë™í–¥\n2. êµ­ì œ ì •ì¹˜ ì†Œì‹\n3. ì‚¬íšŒ ì´ìŠˆ\n4. ë¬¸í™” ì˜ˆìˆ \n5. ìŠ¤í¬ì¸  ì†Œì‹',
                    data: { type: 'news_main' },
                    timestamp: new Date(Date.now() - 7200000).toISOString(), // 2ì‹œê°„ ì „
                    sent: true
                }
            ];
            
            localStorage.setItem('notificationHistory', JSON.stringify(testNotifications));
            log('í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°ì´í„° ì¶”ê°€ ì™„ë£Œ', 'success');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            log('ê°œì¸ ë¹„ì„œ ìë™í™” ì‹œìŠ¤í…œ ì‹œì‘', 'success');
            
            // Service Worker ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupServiceWorkerMessageListener();
            
            // GitHub Actions ëª¨ë‹ˆí„°ë§ ë¡œë“œ
            loadGithubMonitoring();
            
            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ (ìµœì´ˆ 1íšŒë§Œ)
            addTestNotificationData();
            
            if (fcmToken) {
                document.getElementById('fcmTokenInput').value = fcmToken;
            }
            
            updateStatus();
            
            // 5ì´ˆë§ˆë‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            setInterval(updateStatus, 5000);
            
            // 1ë¶„ë§ˆë‹¤ GitHub Actions ëª¨ë‹ˆí„°ë§ ì‹œê°„ ì—…ë°ì´íŠ¸
            setInterval(loadGithubMonitoring, 60000);
        });
        
        // FCM ë©”ì‹œì§€ ìˆ˜ì‹  ì²˜ë¦¬ ë° ë‚´ì—­ ì €ì¥
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'FCM_MESSAGE') {
                    log('FCM ë©”ì‹œì§€ ìˆ˜ì‹ : ' + event.data.title, 'success');
                    
                    // ì•Œë¦¼ ë‚´ì—­ ì €ì¥
                    const notification = {
                        id: Date.now(),
                        title: event.data.title,
                        body: event.data.body,
                        data: event.data.data || {},
                        timestamp: new Date().toISOString(),
                        sent: true
                    };
                    
                    const history = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
                    history.unshift(notification);
                    
                    // ìµœëŒ€ 100ê°œê¹Œì§€ë§Œ ë³´ê´€
                    if (history.length > 100) {
                        history.splice(100);
                    }
                    
                    localStorage.setItem('notificationHistory', JSON.stringify(history));
                }
            });
        }
    </script>
</body>
</html>