<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ ë¹„ì„œ ìë™í™”</title>
    <meta name="description" content="ë‚ ì”¨ì™€ Notion ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ê°œì¸ ë¹„ì„œ">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2196F3">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .status.active {
            background: #4CAF50;
            color: white;
        }
        
        .status.inactive {
            background: #f44336;
            color: white;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list li::before {
            content: "âœ…";
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .notification-item {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        
        .notification-item h4 {
            margin-bottom: 8px;
            color: #333;
        }
        
        .notification-item p {
            color: #666;
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .notification-item small {
            color: #999;
        }
        
        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .install-prompt {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .install-prompt button {
            background: white;
            color: #4CAF50;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .card {
                padding: 20px;
            }
        }
        
        .detail-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .detail-btn:hover {
            background: #138496;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¤– ê°œì¸ ë¹„ì„œ ìë™í™”</h1>
            <p>ìŠ¤ë§ˆíŠ¸í•œ ì¼ì • ê´€ë¦¬ì™€ ì•Œë¦¼ ì„œë¹„ìŠ¤</p>
        </header>
        
        <div class="install-prompt" id="installPrompt">
            ğŸ“± ì´ ì•±ì„ í™ˆí™”ë©´ì— ì„¤ì¹˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            <button onclick="installApp()">ì„¤ì¹˜</button>
            <button onclick="hideInstallPrompt()">ë‚˜ì¤‘ì—</button>
        </div>
        
        <div class="card">
            <h2>ğŸ”” ì•Œë¦¼ ì„œë¹„ìŠ¤</h2>
            <div class="status active">í™œì„±í™”ë¨</div>
            <ul class="feature-list">
                <li>ë§¤ì¼ ì˜¤ì „ 7ì‹œ ì•„ì¹¨ ë¸Œë¦¬í•‘ (ë‚ ì”¨, ì˜¤ëŠ˜ ì¼ì •, ë‰´ìŠ¤)</li>
                <li>ë§¤ì¼ ì˜¤í›„ 7ì‹œ ì €ë… ë¸Œë¦¬í•‘ (ë‚´ì¼ ì¼ì •, HIGH ìš°ì„ ìˆœìœ„ ì‘ì—…)</li>
                <li>ë‚ ì”¨ ë³€í™” ì‹¤ì‹œê°„ ì•Œë¦¼ (2ì‹œê°„ë§ˆë‹¤ ì²´í¬)</li>
                <li>Notion ìº˜ë¦°ë” ë° íƒœìŠ¤í¬ ì—°ë™</li>
            </ul>
        </div>
        
        <div class="card">
            <h2>ğŸ“‹ ìµœì‹  ì•Œë¦¼ ë‚´ì—­</h2>
            <div id="notificationHistory">
                <div class="empty-state">ì•„ì§ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
            <button class="btn" onclick="clearHistory()">ë‚´ì—­ ì§€ìš°ê¸°</button>
        </div>
        
        <div class="card">
            <h2>âš™ï¸ í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥</h2>
            <p>ì•Œë¦¼ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.</p>
            <button class="btn" onclick="requestNotificationPermission()">ì•Œë¦¼ ê¶Œí•œ ìš”ì²­</button>
            <button class="btn" onclick="testNotification()">í…ŒìŠ¤íŠ¸ ì•Œë¦¼</button>
            <button class="btn" onclick="registerServiceWorker()">ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡</button>
        </div>
        
        <div class="card">
            <h2>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h2>
            <p><strong>ì•Œë¦¼ ê¶Œí•œ:</strong> <span id="notificationPermission">í™•ì¸ ì¤‘...</span></p>
            <p><strong>ì„œë¹„ìŠ¤ ì›Œì»¤:</strong> <span id="serviceWorkerStatus">í™•ì¸ ì¤‘...</span></p>
            <p><strong>PWA ì„¤ì¹˜:</strong> <span id="pwaStatus">í™•ì¸ ì¤‘...</span></p>
        </div>
    </div>
    
    <!-- ì•Œë¦¼ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="notificationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;">
        <div style="background: white; margin: 50px auto; padding: 30px; border-radius: 15px; max-width: 600px; position: relative;">
            <button onclick="closeModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
            <h3 id="modalTitle" style="margin-bottom: 20px; color: #333;"></h3>
            <div id="modalContent" style="line-height: 1.6; color: #555; white-space: pre-wrap;"></div>
        </div>
    </div>
    
    <script>
        let deferredPrompt;
        const notificationHistory = JSON.parse(localStorage.getItem('notificationHistory')) || [];
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ìŠ¹ì¸í–ˆìŠµë‹ˆë‹¤');
                    }
                    deferredPrompt = null;
                    hideInstallPrompt();
                });
            }
        }
        
        function hideInstallPrompt() {
            document.getElementById('installPrompt').style.display = 'none';
        }
        
        // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/service-worker.js');
                    console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì„±ê³µ:', registration);
                    updateSystemStatus();
                    alert('ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:', error);
                    alert('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                console.log('ì•Œë¦¼ ê¶Œí•œ:', permission);
                updateSystemStatus();
                if (permission === 'granted') {
                    alert('ì•Œë¦¼ ê¶Œí•œì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    alert('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ì•Œë¦¼
        function testNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification('ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼', {
                    body: 'ê°œì¸ ë¹„ì„œ ìë™í™” ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    icon: '/icons/icon-192.png',
                    badge: '/icons/icon-72.png',
                    tag: 'test-notification',
                    timestamp: Date.now()
                });
                
                // ì•Œë¦¼ ë‚´ì—­ì— ì¶”ê°€
                addToHistory({
                    title: 'ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
                    body: 'ê°œì¸ ë¹„ì„œ ìë™í™” ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    timestamp: new Date().toISOString()
                });
                
                setTimeout(() => notification.close(), 5000);
            } else {
                alert('ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤!');
            }
        }
        
        // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSystemStatus() {
            // ì•Œë¦¼ ê¶Œí•œ ìƒíƒœ
            const permissionStatus = Notification.permission;
            document.getElementById('notificationPermission').textContent = 
                permissionStatus === 'granted' ? 'âœ… í—ˆìš©ë¨' : 
                permissionStatus === 'denied' ? 'âŒ ê±°ë¶€ë¨' : 'âš ï¸ ë¯¸ì„¤ì •';
            
            // ì„œë¹„ìŠ¤ ì›Œì»¤ ìƒíƒœ
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(() => {
                    document.getElementById('serviceWorkerStatus').textContent = 'âœ… í™œì„±í™”ë¨';
                }).catch(() => {
                    document.getElementById('serviceWorkerStatus').textContent = 'âŒ ë¹„í™œì„±í™”ë¨';
                });
            } else {
                document.getElementById('serviceWorkerStatus').textContent = 'âŒ ì§€ì› ì•ˆ ë¨';
            }
            
            // PWA ì„¤ì¹˜ ìƒíƒœ
            if (window.matchMedia('(display-mode: standalone)').matches) {
                document.getElementById('pwaStatus').textContent = 'âœ… ì„¤ì¹˜ë¨';
            } else {
                document.getElementById('pwaStatus').textContent = 'ğŸ“± ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ ì¤‘';
            }
        }
        
        // ì•Œë¦¼ ë‚´ì—­ ì¶”ê°€
        function addToHistory(notification) {
            notificationHistory.unshift(notification);
            if (notificationHistory.length > 50) {
                notificationHistory.pop();
            }
            localStorage.setItem('notificationHistory', JSON.stringify(notificationHistory));
            displayNotificationHistory();
        }
        
        // ì•Œë¦¼ ë‚´ì—­ í‘œì‹œ
        function displayNotificationHistory() {
            const historyDiv = document.getElementById('notificationHistory');
            
            if (notificationHistory.length === 0) {
                historyDiv.innerHTML = '<div class="empty-state">ì•„ì§ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            historyDiv.innerHTML = notificationHistory.map((notification, index) => {
                const date = new Date(notification.timestamp);
                const formattedDate = date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR');
                
                return `
                    <div class="notification-item">
                        <h4>${notification.title}</h4>
                        <p>${notification.body.length > 100 ? notification.body.substring(0, 100) + '...' : notification.body}</p>
                        <small>${formattedDate}</small>
                        ${notification.body.length > 100 ? `<button class="detail-btn" onclick="showNotificationDetail(${index})">ì „ì²´ ë³´ê¸°</button>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // ì•Œë¦¼ ìƒì„¸ë³´ê¸°
        function showNotificationDetail(index) {
            const notification = notificationHistory[index];
            const modal = document.getElementById('notificationModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.textContent = notification.title;
            modalContent.textContent = notification.body;
            modal.style.display = 'block';
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('notificationModal').style.display = 'none';
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('notificationModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
        
        // ë‚´ì—­ ì§€ìš°ê¸°
        function clearHistory() {
            if (confirm('ì•Œë¦¼ ë‚´ì—­ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                notificationHistory.length = 0;
                localStorage.removeItem('notificationHistory');
                displayNotificationHistory();
            }
        }
        
        // ì„œë¹„ìŠ¤ ì›Œì»¤ì—ì„œ ì•Œë¦¼ ìˆ˜ì‹  ì²˜ë¦¬
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'NOTIFICATION_RECEIVED') {
                    addToHistory({
                        title: event.data.title,
                        body: event.data.body,
                        timestamp: event.data.timestamp || new Date().toISOString()
                    });
                }
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            updateSystemStatus();
            displayNotificationHistory();
            registerServiceWorker();
        });
    </script>
</body>
</html>